<div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;json&#39;</span>

<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">&#39;http://localhost:8081/api/authinfo/inquire/PIGEON&#39;</span><span class="p">)</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

<span class="k">begin</span>
  <span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">initheader</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span><span class="s1">&#39;application/json&#39;</span><span class="p">})</span>
  <span class="n">req</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span> <span class="no">AuthInfoName</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">to_json</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ECONNREFUSED</span>
  <span class="nb">puts</span> <span class="s2">&quot;Can&#39;t connect to MQWeb is it running?&quot;</span>
  <span class="nb">abort</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;200&quot;</span>
  <span class="n">json</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">json</span><span class="o">[</span><span class="s2">&quot;error&quot;</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="s2">&quot;An MQException occurred: RC= </span><span class="si">#{</span><span class="n">json</span><span class="o">[</span><span class="s2">&quot;error&quot;</span><span class="o">][</span><span class="s2">&quot;reason&quot;</span><span class="o">][</span><span class="s2">&quot;code&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">json</span><span class="o">[</span><span class="s2">&quot;error&quot;</span><span class="o">][</span><span class="s2">&quot;reason&quot;</span><span class="o">][</span><span class="s2">&quot;desc&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">else</span>
    <span class="n">json</span><span class="o">[</span><span class="s2">&quot;authinfos&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">authinfo</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="n">authinfo</span><span class="o">[</span><span class="s2">&quot;AuthInfoName&quot;</span><span class="o">][</span><span class="s2">&quot;value&quot;</span><span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">&quot;A problem occurred with HTTP request: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
